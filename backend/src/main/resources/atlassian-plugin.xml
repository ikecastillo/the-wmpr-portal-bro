<?xml version="1.0" encoding="UTF-8"?>

<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2"> 
  <plugin-info> 
    <description>${project.description}</description>  
    <version>1.0.1</version>  
    <vendor name="${project.organization.name}" url="${project.organization.url}"/>  
  </plugin-info>
  
  <!-- React bundle resources are auto-generated by WrmPlugin in META-INF/plugin-descriptors/wr-defs.xml -->
  
  <!-- Main Web Panel for Service Desk Footer -->
  <web-panel location="servicedesk.portal.footer" key="wmpr-requests-panel">
    <description>Displays recent WMPR requests in Service Desk portal - IKKKKKKE-PLUGIN-100</description>
    <label>WMPR Recent Requests</label>
    <resource name="view" type="velocity" location="/templates/wmpr-web-panel.vm"/>
    <!-- ENHANCED: Proper dependency loading order for React + AtlasKit -->
    <dependency>com.atlassian.plugins.atlassian-plugins-webresource-plugin:web-resource-manager</dependency>
    <dependency>com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path</dependency>
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <dependency>jira.webresources:jira-global</dependency>
    <dependency>jira.webresources:util</dependency>
    <!-- React must be loaded before our components -->
    <dependency>com.atlassian.jira.plugins.jira-react-plugin:react</dependency>
    <!-- AtlasKit dependencies -->
    <dependency>com.atlassian.servicedesk:sd-common-ui</dependency>
    <dependency>com.atlassian.auiplugin:aui-experimental-atlaskit-wrapper</dependency>
    <!-- FIXED: Correct key for auto-generated web resource -->
    <dependency>${atlassian.plugin.key}:entrypoint-wmprRequestsTable</dependency>
    <!-- FALLBACK: Manual web resource if auto-generated fails -->
    <dependency>${atlassian.plugin.key}:wmpr-manual-fallback</dependency>
  </web-panel>
  
  <!-- Additional Web Panel for Testing in General Context -->
  <web-panel location="atl.general" key="wmpr-requests-panel-general">
    <description>Displays recent WMPR requests in general context for testing - IKKKKKKE-PLUGIN-101</description>
    <label>WMPR Recent Requests (General)</label>
    <resource name="view" type="velocity" location="/templates/wmpr-web-panel.vm"/>
    <!-- ENHANCED: Same improved dependency loading -->
    <dependency>com.atlassian.plugins.atlassian-plugins-webresource-plugin:web-resource-manager</dependency>
    <dependency>com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path</dependency>
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <dependency>jira.webresources:jira-global</dependency>
    <dependency>jira.webresources:util</dependency>
    <!-- React must be loaded before our components -->
    <dependency>com.atlassian.jira.plugins.jira-react-plugin:react</dependency>
    <!-- AtlasKit dependencies -->
    <dependency>com.atlassian.auiplugin:aui-experimental-atlaskit-wrapper</dependency>
    <!-- FIXED: Correct key for auto-generated web resource -->
    <dependency>${atlassian.plugin.key}:entrypoint-wmprRequestsTable</dependency>
    <!-- FALLBACK: Manual web resource if auto-generated fails -->
    <dependency>${atlassian.plugin.key}:wmpr-manual-fallback</dependency>
  </web-panel>
  
  <!-- Project Settings Web Item -->
  <web-item key="wmpr-settings-link" name="WMPR Settings" section="atl.jira.proj.config/projectgroup1" weight="40">
    <description>Configure WMPR requests settings for this project</description>
    <label>WMPR Settings</label>
    <link>/plugins/servlet/wmpr-settings?projectKey=${project.key}</link>
  </web-item>
  
  <!-- Servlet for Settings Page -->
  <servlet name="WMPR Settings Servlet" key="wmpr-settings-servlet" class="com.example.wmpr.servlet.WmprSettingsServlet">
    <description>Servlet for WMPR settings configuration</description>
    <url-pattern>/wmpr-settings</url-pattern>
  </servlet>
  
  <!-- REST Endpoint for API -->
  <rest name="WMPR Requests REST" key="wmpr-requests-rest" path="/wmpr-requests" version="1.0">
    <description>REST API for WMPR requests</description>
    <package>com.example.wmpr.rest</package>
  </rest>
  
  <!-- React Component Web Resources are auto-generated by WrmPlugin -->
  
  <!-- FALLBACK: Manual web resource for critical dependencies -->
  <web-resource key="wmpr-manual-fallback" name="WMPR Manual Fallback">
    <description>Manual fallback web resource for WMPR components - IKKKKKKE-PLUGIN-104</description>
    <!-- Ensure all critical dependencies are loaded -->
    <dependency>com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path</dependency>
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <dependency>jira.webresources:jira-global</dependency>
    <dependency>jira.webresources:util</dependency>
    <dependency>com.atlassian.jira.plugins.jira-react-plugin:react</dependency>
    <dependency>com.atlassian.auiplugin:aui-experimental-atlaskit-wrapper</dependency>
    <!-- Include bundled files directly if auto-generated fails -->
    <resource type="download" name="bundled.wmprRequestsTable.js" location="/frontend/bundled.wmprRequestsTable.js"/>
    <resource type="download" name="bundled.wmprSettings.js" location="/frontend/bundled.wmprSettings.js"/>
    <context>servicedesk.portal.footer</context>
    <context>atl.general</context>
    <context>atl.admin</context>
    <context>jira.project.sidebar</context>
  </web-resource>
  
  <!-- Custom CSS for UI Enhancements -->
  <web-resource key="wmpr-custom-styles" name="WMPR Custom Styles">
    <description>Custom CSS for enhanced WMPR UI styling - IKKKKKKE-PLUGIN-102</description>
    <resource type="download" name="wmpr-custom.css" location="/css/wmpr-custom.css"/>
    <context>atl.general</context>
  </web-resource>
  
  <!-- Custom JavaScript for UI Enhancements -->
  <web-resource key="wmpr-custom-scripts" name="WMPR Custom Scripts">
    <description>Custom JavaScript for enhanced WMPR UI interactions - IKKKKKKE-PLUGIN-103</description>
    <resource type="download" name="wmpr-custom.js" location="/js/wmpr-custom.js"/>
    <context>atl.general</context>
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <dependency>jira.webresources:jira-global</dependency>
  </web-resource>

</atlassian-plugin>
